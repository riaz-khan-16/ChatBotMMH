<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>My Chatbot</title>
  <style>
    body { font-family: Arial, sans-serif; background: #f4f4f4; }
    .chat-container { 
      width: 400px; 
      margin: 50px auto; 
      background: white; 
      border-radius: 10px; 
      box-shadow: 0 4px 10px rgba(0,0,0,0.2); 
      display: flex;
      flex-direction: column;
      height: 500px;
    }
    .chat-header {
      background: #0078ff;
      color: white;
      padding: 15px;
      border-top-left-radius: 10px;
      border-top-right-radius: 10px;
      text-align: center;
      font-weight: bold;
      font-size: 18px;
    }
    .chat-box { 
      flex: 1;
      height: 600px; /* increased height */
      overflow-y: auto; 
      padding: 10px; 
      border-bottom: 1px solid #ddd; 
    }
    .message { margin: 5px 0; padding: 10px; border-radius: 10px; max-width: 70%; }
    .user { background: #0078ff; color: white; margin-left: auto; }
    .bot { background: #eee; color: black; margin-right: auto; }
    .input-area { display: flex; padding: 10px; }
    input { flex: 1; padding: 10px; border: 1px solid #ccc; border-radius: 5px; }
    button { margin-left: 10px; padding: 10px 15px; background: #0078ff; border: none; color: white; border-radius: 5px; cursor: pointer; }
    button:hover { background: #005fcc; }
  </style>
</head>
<body>
  <div class="chat-container">
    <div class="chat-header">My Chatbot</div>
    <div class="chat-box" id="chat-box"></div>
    <div class="input-area">
      <input type="text" id="user-input" placeholder="Type a message...">
      <button onclick="sendMessage()">Send</button>
    </div>
  </div>

  <script>

 //This function will run when the user will click send button
  async function sendMessage() {

    const inputField = document.getElementById("user-input"); // 1. get the input
    console.log("Got input field:", inputField);

    const userMessage=inputField.value.trim()  // 2. get the input value
    console.log("Value of input is: ", userMessage); 

    if (!userMessage) {  //3. if not value is found return
        console.log("No message entered, exiting function");
        return;
    }

    appendMessage(userMessage, "user"); // 4. use the input and show it to the box
    console.log("Appended user message to chat");



    const response="Hi, I am a chatbot" // prepare the response
    console.log("Response is prepared: ", response)


    // 5. get data from backend 
    const response1 = await fetch("/get-response/", {
      method: "POST",
      headers: {
        "Content-Type": "application/x-www-form-urlencoded",
        "X-CSRFToken": getCSRFToken() // required by Django
      },
      body: "message=" + encodeURIComponent(userMessage)
    });

    const data = await response1.json();
    console.log("backend response: ", data.reply);




    
   // 6. show and append this message as a  bot
    appendMessage(data.reply, "bot"); // show the response in html page
    console.log("Appended bot message to chat");


    inputField.value = ""; // clear the input value
    console.log("Cleared input field");


    









  }

  // function: responsible for showing a new chat bubble inside the chat window.
  function appendMessage(text, sender) {
    const chatBox = document.getElementById("chat-box"); // Get the chat container (the area that shows messages)
    const messageDiv = document.createElement("div");  // Create a new <div> element to hold the message
    messageDiv.classList.add("message", sender); //Add CSS classe
    messageDiv.textContent = text;   // Put the actual text (what user or bot said) inside the div
    chatBox.appendChild(messageDiv);  //  Add this new message div to the chat box (append at bottom)
    chatBox.scrollTop = chatBox.scrollHeight; // Scroll down automatically so the newest message is visible
  }





  // function:  for csrf token

  function getCSRFToken() {
  let cookieValue = null;
  const cookies = document.cookie.split(";");
  for (let cookie of cookies) {
    cookie = cookie.trim();
    if (cookie.startsWith("csrftoken=")) {
      cookieValue = cookie.substring("csrftoken=".length, cookie.length);
      break;
    }
  }
  return cookieValue;
}





  </script>
</body>
</html>
